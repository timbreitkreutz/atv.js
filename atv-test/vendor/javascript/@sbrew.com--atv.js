// @sbrew.com/atv@0.0.25 downloaded from https://ga.jspm.io/npm:@sbrew.com/atv@0.0.25/atv.js

const t=JSON.parse(document.querySelector("script[type='importmap']").innerText).imports;const e=/[\-_]/;const n=/,[\s+]/;function pascalize(t){return t.split(e).map((function(t){return t.charAt(0).toUpperCase()+t.slice(1)})).join("")}function camelize(t){const e=pascalize(t);return e.charAt(0).toLowerCase()+e.slice(1)}function allPermutations(t,n,o=null){const r=t.split(e);if(r.length<2)if(o){n(`${o}-${t}`);n(`${o}_${t}`)}else n(t);else if(o){allPermutations(r.slice(1).join("-"),n,`${o}-${r[0]}`);allPermutations(r.slice(1).join("-"),n,`${o}_${r[0]}`)}else allPermutations(r.slice(1).join("-"),n,`${r[0]}`)}function selectPermutations(t,e,n){allPermutations(`data-${e}`,(function(e){t.querySelectorAll(`[${e}]`).forEach((function(t){const o=camelize(e.replace(/^data-/,""));n(t,o,e)}))}))}function jsonParseArray(t){return/^[\[{]/.test(t)?JSON.parse(t):t.split(n).map((function(t){return t.trim()}))}let parseActions=function(t){const e=jsonParseArray(t);return e.map((function(t){let[e,o]=t.split(/[\-=]>/);if(!o){o=e;e=e.split(/[#(),]/)[0]}let[r,c]=o.split("#");if(!c){c=r;r=void 0}let[i,s]=c.split(/[()]/);i||(i=e);s&&(s=s.split(n));return[e,i,r,s]}))};function dataFor(t,e){if(!t.dataset)return;let n=t.dataset[e]||t.dataset[camelize(e)];n||allPermutations(e,(function(e){n||(n=t.dataset[e])}));return n}function activate(e="atv-"){let o=new Map;let r=false;const c=new MutationObserver(domWatcher);function controllersFor(t){const o=dataFor(t,`${e}controller`);return o?o.replace(/_/g,"-").split(n):[]}let i=[];allPermutations(`data-${e}controller`,(function(t){i.push(`[${t}]`)}));const s=i.join(",");function outOfScope(t,e,n){const o=t.closest(s);let r=false;controllersFor(o).forEach((function(t){t===n&&(r=!(o===e))}));return r}function containingNamedController(t,e){const n=t.closest(s);if(!n)return;let o;controllersFor(n).forEach((function(t){o||t!==e||(o=n)}));return o||containingNamedController(n.parentNode,e)}function findActions(t,n,r,c){let i=[];function registerAction(e,o){parseActions(o).forEach((function(o){const[s,a,l,u]=o;if(l&&l!==n)return;if(r!==a)return;if(outOfScope(e,t,n))return;const callback=function(t){return c(t.target,t,u)};i.push([e,s,callback]);e.addEventListener(s,callback)}))}selectPermutations(t,`${e}${n}-action`,(function(t,e){const o=`["${t.dataset[e]}"]`;o?registerAction(t,o):console.error(`Malformed action: ${n}/${e}`)}));selectPermutations(t,`${e}${n}-actions`,(function(t,e){const o=t.dataset[e];o?registerAction(t,o):console.error(`Malformed actions: ${n}/${e}`)}));function buildSequence(t,e){function invokeNext(t,e){return function(n){const r=t[0];if(!r)return false;const[c,i,s,a]=r;const l=t.slice(1);if(!s||c!==e)return invokeNext(l,e)(n);const u=containingNamedController(n.target,s);if(!u)return invokeNext(l,e)(n);const f=o.get(u)[s]?.actions;if(f){const t=f[i];if(t){const o=t(n.target,n,a);return!!o&&invokeNext(l,e)(n)}}return invokeNext(l,e)(n)}}const n=t.dataset[e];if(!n)return;const r=parseActions(n);const c=new Set;r.forEach((function(t){c.add(t[0])}));c.forEach((function(e){let n=false;r.forEach((function(t){const[o]=t;e===o&&(n=true)}));if(n){const n=invokeNext(r,e);i.push([t,e,n]);t.addEventListener(e,n)}}))}selectPermutations(t,`${e}actions`,(function(t,e){buildSequence(t,e)}));selectPermutations(t,`${e}action`,(function(t,e){buildSequence(t,e)}));return i}function findTargets(t,n){const o=t.parentNode;let r={};selectPermutations(o,`${e}${n}-target`,(function(o){if(outOfScope(o,t,n))return;const c=`${e}${n}-target`;const i=dataFor(o,c);const s=`all${pascalize(i)}`;if(r[s])r[s].push(o);else if(r[i]){r[s]=[r[i],o];delete r[i]}else r[i]=o}));return r}function findValues(t,n){let o=t.parentNode;let r;const c=`${e}${n}-values`;selectPermutations(o,c,(function(e){if(r||outOfScope(e,t,n))return;const o=dataFor(e,c);o&&(r=JSON.parse(o))}));return r}function cleanupController(t,e){const n=t[e];const o=n.handlers;Object.keys(o).forEach((function(t){const e=o[t];e.forEach((function(t){t[0].removeEventListener(t[1],t[2])}))}));if(n.disconnect){n.disconnect();n.disconnect=void 0}}function findControllers(t,e,n){document.querySelectorAll(t).forEach((function(t){const r=o.get(t);r&&r[e]&&n(r[e])}))}function createController(t,e,n){let r=o.get(t);r||(r={});r[e]&&cleanupController(r,e);let c={actions:{},handlers:{},name:e,root:t};c.targets=findTargets(t,e);c.values=findValues(t,e);let i=n.connect(c.targets,c.values,t,findControllers);typeof i==="function"&&(i=i());Object.keys(i).forEach((function(n){c.actions[n]=i[n];n==="disconnect"?c.disconnect=i[n]:c.handlers[n]=findActions(t,e,n,i[n])}));r[e]=c;o.set(t,r)}function registerController(e){controllersFor(e).forEach((function(n){let o=`${n}_atv`;Object.keys(t).forEach((function(e){e.replace(/_/g,"-").includes(`/${n}-atv`)&&(o=t[e])}));import(o).then((function(t){createController(e,n,t)})).catch((function(t){console.error("Loading failed:",t)}))}))}function cleanup(){c.disconnect();o.forEach((function(t){Object.keys(t).forEach((function(e){cleanupController(t,e)}))}));o=new Map}function report(t,n){n<1||console.log([`${e}controllers: ${o.size} present`,`${n} added. (${t})`].join(" / "))}function domWatcher(t){if(!r)return;let n=false;t.forEach((function(t){n||t.type==="childList"&&t.removedNodes.forEach((function(t){if(n||!t.querySelector)return;if(t.dataset){const o=dataFor(t,`${e}controller`);if(o){n=true;return}}const o=t.querySelector(s);o&&(n=true)}))}));if(n){cleanup();activate(e);return}let c=new Set;t.forEach((function(t){t.type==="childList"&&t.addedNodes.forEach((function(t){t.parentNode?.querySelector&&t.parentNode.querySelectorAll(s).forEach((function(t){if(!c.has(t)&&!o.has(t)){registerController(t);c.add(t)}}))}))}));c.size>0&&report("mutation",c.size)}let a=0;document.querySelectorAll(s).forEach((function(t){registerController(t);a+=1}));report("activate",a);r=true;const l={childList:true,subtree:true};c.observe(document,l)}export{activate};

